---
title: كيف يعمل
description: شرح مختصر لـ "العلم" وراء Safeparts.
---

Safeparts مبني على ثلاث أفكار:

1. تقسيم السر بحيث لا تكشف حصة واحدة عنه.
2. الاسترداد فقط عندما تتعاون حصص كافية.
3. كشف الأخطاء (حصص خاطئة، أخطاء كتابة، عبارة مرور خاطئة).

## المشاركة بالعتبة (k من n)

أنت تختار العتبة (<var>k</var> من <var>n</var>):

- أقل من <var>k</var> حصص: الاسترداد مستحيل.
- أي <var>k</var> حصص: الاسترداد ينجح.

تحت الغطاء هذا شبيه بـ Shamir secret sharing فوق مجال منتهٍ (<span class="token token--mono" dir="ltr">GF(256)</span>) بشكل byte-wise.

### ما هي “الحصة”؟

بشكل مبسط، كل حصة تمثل نقطة واحدة على كثير حدود من الدرجة <var>k</var>-1.
عند امتلاك <var>k</var> نقاط يمكنك إعادة تركيب كثير الحدود وبالتالي استعادة السر.
وأقل من <var>k</var> نقاط لا يعطي معلومات مفيدة عن السر.

### لماذا <span class="token token--mono" dir="ltr">GF(256)</span>؟

Safeparts يعمل على بايتات. <span class="token token--mono" dir="ltr">GF(256)</span> يسمح بالعمليات الرياضية على قيم 8-bit بحيث ينطبق التقسيم على بيانات ثنائية بأي شكل.

## السلامة (Integrity)

Safeparts يضيف وسم سلامة بحيث يمكن للاسترداد كشف المدخلات الخاطئة.

- إذا كانت الحصص تالفة أو من مجموعات مختلفة، تفشل عملية الاسترداد.
- إذا أخطأت في كتابة حصة، تفشل عملية الاسترداد.

بالإضافة إلى وسم الحزمة:

- Base58Check يحتوي checksum.
- حصص mnemonic تحتوي CRC16 لكشف كثير من أخطاء الكتابة.

## حماية اختيارية بعبارة مرور

يمكن لـ Safeparts تشفير السر قبل التقسيم.

بشكل مبسط:

- اشتقاق مفتاح من عبارة المرور (Argon2id).
- تشفير السر (ChaCha20-Poly1305).
- تقسيم البايتات المشفرة إلى حصص.

هذا يعني أن المهاجم يحتاج <var>k</var> حصص وعبارة المرور معاً.

:::note
عبارة المرور تضيف شرطاً ثانياً؛ لكنها لا تستبدل فصل الحصص بشكل جيد.
:::

## الترميزات

يمكن ترميز الحصص لسيناريوهات مختلفة:

- مناسبة للأتمتة (نسخ/لصق): base64url, base58check
- مناسبة للكتابة اليدوية: صيغ mnemonic

راجع [الترميزات](encodings/).

## بيانات الحزمة (لماذا يجب أن تتطابق الحصص)

الحصص ليست مجرد "أجزاء". كل حصة تحمل بيانات تعريف تضمن أنها من نفس المجموعة:

- العتبة (<var>k</var>) وعدد الحصص (<var>n</var>)
- هوية المجموعة / إصدار الصيغة
- بيانات السلامة

ولهذا يجب أن يفشل خلط حصص من عمليات تقسيم مختلفة بشكل واضح.

## ما الذي لا يفعله Safeparts

- لا يحفظ الحصص بأمان نيابةً عنك. قرارات التخزين هي حد الأمان الحقيقي.
- لا يمنع من يملك <var>k</var> حصصاً بشكل شرعي من الاسترداد.

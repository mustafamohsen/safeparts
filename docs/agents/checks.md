# Agent Checks (Build / Lint / Test)

Source of truth:

- `.github/workflows/rust-ci.yml`
- `.github/workflows/web-ci.yml`

## Rust (Cargo)

**Prereqs**

- Install Rust toolchain (stable) and `rustfmt` + `clippy` components.

**Build**

- Debug: `cargo build`
- Release: `cargo build --release`

**Lint**

- Clippy (recommended): `cargo clippy --all-targets --all-features`
- Deny warnings (CI-style): `cargo clippy --all-targets --all-features -- -D warnings`

**Format**

- Check formatting: `cargo fmt --all -- --check`
- Auto-format: `cargo fmt --all`

**Test (all)**

- `cargo test --all-features`

**Run a single test (most important)**

- By test name substring: `cargo test <test_name_substring>`
- Exact module path: `cargo test gf256::tests::mul_matches_aes_vectors`
- Single test with output: `cargo test <pattern> -- --nocapture`
- Single crate (workspace): `cargo test -p safeparts_core <pattern>`
- Single file/module (common approach): `cargo test -p safeparts_core gf256::`
- Single e2e test (CLI): `cargo test -p safeparts --test e2e <pattern>`

**Benchmarks (only if added)**

- `cargo bench`

## React / TypeScript (Web UI)

**Location**: `web/`

**Package manager**

- CI uses `bun`.
- Lockfiles are committed: `web/bun.lock` and `web/help/bun.lock`.
- Install deps: `bun install`

**WASM build (required before UI works)**

- From `web/`: `bun run build:wasm`

**Run / Build**

- Dev server (from `web/`): `bun run dev`
- Production build (from `web/`): `bun run build`

**Notes**

- `web/src/wasm_pkg/` is generated by `wasm-pack` and is gitignored.
- In dev, Vite proxies `/help` to the docs server (see `web/vite.config.mjs`).

## Docs site (Astro + Starlight)

- Location: `web/help/` (served under `/help/`)
- Dev server: `bun run dev`
- Production build: `bun run build`

## Web tests (Playwright + axe a11y)

- Tests live under `web/tests/`.
- Install browser (from `web/`): `bun run test:a11y:install`
- Smoke suite (from `web/`): `bun run test:e2e:smoke`
- Full suite (from `web/`): `bun run test:e2e:full`
- Legacy/all-tests alias (from `web/`): `bun run test:a11y`

## OpenSpec tooling

- `openspec/` and `.opencode/` contain OpenSpec artifacts/tooling; avoid editing unless the task is explicitly about specs/tool config.
